language: php

sudo: false
dist: trusty

matrix:
  include:
    - php: 7.3
      env: WP_VERSION=4.9.10
    - php: 7.2
      env: WP_VERSION=4.8.9
    - php: 7.1
      env: WP_VERSION=4.7.13
    - php: 7.0
      env: WP_VERSION=4.6.6
    - php: 7.0
      env: WP_VERSION=4.5.9
    - php: 5.6
      env: WP_VERSION=4.4.10
    - php: 5.6
      env: WP_VERSION=4.3.11
    - php: 5.5
      env: WP_VERSION=4.2.15
    - php: 5.4
      env: WP_VERSION=4.1.18
    - php: 5.3
      env: WP_VERSION=4.0.18
      dist: precise
    - php: 5.2
      env: WP_VERSION=3.9.13
      dist: precise

install:
- npm install grunt-cli
- npm install
  
before_script:
- if [[ ! ( $TRAVIS_PHP_VERSION = '7.1' && $WP_VERSION = 'latest' ) ]]; then phpenv config-rm xdebug.ini || true; fi
- if [[ "$WP_TRAVISCI" == "travis:phpunit" && ( $TRAVIS_PHP_VERSION = '7.2' || $TRAVIS_PHP_VERSION = '7.3' ) ]]; then composer global require "phpunit/phpunit:^6"; fi
- bash bin/install-wp-tests.sh wordpress_test root '' localhost $WP_VERSION

script: 
- PHPRC=. WP_TESTS_DIR=/tmp/wordpress-tests-lib phpunit --verbose
- ln -s /tmp/wordpress src && WP_TESTS_DIR=/tmp/wordpress-tests-lib grunt --verbose test_qunit

after_success:
- if [[ $TRAVIS_PHP_VERSION = '7.1' && $WP_VERSION = 'latest' ]]; then PHPRC=. WP_TESTS_DIR=/tmp/wordpress-tests-lib phpunit --coverage-clover clover.xml && bash <(curl -s https://codecov.io/bash); fi
