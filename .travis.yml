language: php

sudo: false

php:
- 7.1
- 7.0
- 5.2
- 5.3
- 5.4
- 5.5
- 5.6

env:
- WP_VERSION=nightly
- WP_VERSION=latest
- WP_VERSION=4.6.1
- WP_VERSION=4.5.4
- WP_VERSION=4.4.5
- WP_VERSION=4.3.6
- WP_VERSION=4.2.10
- WP_VERSION=4.1.13
- WP_VERSION=4.0.13
- WP_VERSION=3.9.13

matrix:
  exclude:
    - php: 7.1
      env: WP_VERSION=latest
    - php: 7.1
      env: WP_VERSION=4.6.1
    - php: 7.1
      env: WP_VERSION=4.5.4
    - php: 7.1
      env: WP_VERSION=4.4.5
    - php: 7.1
      env: WP_VERSION=4.3.6
    - php: 7.1
      env: WP_VERSION=4.2.10
    - php: 7.1
      env: WP_VERSION=4.1.13
    - php: 7.1
      env: WP_VERSION=4.0.13
    - php: 7.1
      env: WP_VERSION=3.9.13
    - php: 7.0
      env: WP_VERSION=4.2.10
    - php: 7.0
      env: WP_VERSION=4.1.13
    - php: 7.0
      env: WP_VERSION=4.0.13
    - php: 7.0
      env: WP_VERSION=3.9.13
  allow_failures:
    - env: WP_VERSION=nightly

install:
- npm install grunt-cli
- npm install
  
before_script:
- node_modules/grunt-cli/bin/grunt test_build
- bash bin/install-wp-tests.sh wordpress_test root '' localhost $WP_VERSION

script: 
- PHPRC=. WP_TESTS_DIR=/tmp/wordpress-tests-lib phpunit

after_success:
- if [[ ( $TRAVIS_PHP_VERSION = '7' || $TRAVIS_PHP_VERSION > '7' ) && $WP_VERSION = 'latest' ]] then
- PHPRC=. WP_TESTS_DIR=/tmp/wordpress-tests-lib phpunit --coverage-clover clover.xml && bash <(curl -s https://codecov.io/bash)
- fi
